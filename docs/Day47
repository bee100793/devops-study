📅 Day 17: Git 연동 및 배포 자동화 실무 정리

1. 실무 도구 비교 (scp / Git / AMI)
[scp & 백업 스크립트]
대상: 데이터(DB), 로그 파일, 보안 인증서
특징: 코드가 아닌 '덩어리' 데이터를 안전하게 옮길 때 사용

[Git & GitHub]
대상: 소스 코드, 쉘 스크립트
특징: 버전 관리, 1초 단위 롤백, 협업의 핵심

[AWS AMI (이미지)]
대상: 서버 통째로 (OS + 환경 설정 + 파일)
특징: 서버 자체가 망가졌을 때 통째로 복구하는 '붕어빵 틀'

2. Git 자동화(git_update.sh)를 해야 하는 이유
무인 배포: 서버에 일일이 접속할 필요 없이 명령 한 방으로 업데이트 가능
효율성: 내 컴퓨터를 거치지 않고 서버가 직접 깃허브에서 데이터를 가져오므로 속도가 빠름
충돌 방지: 배포 시 발생할 수 있는 파일 꼬임 현상을 사전에 차단함

3. Git 충돌 방지 명령어와 필요성
git checkout .
내용: 기존 파일의 수정 사항을 깃허브 원본 상태로 원상복구

git clean -fd
내용: 깃허브에 없는 새로 생긴 파일/폴더를 강제 삭제

필요성: 서버는 '작업실'이 아니라 '전시장'이어야 하므로, 깃허브 본진과 100% 똑같은 상태를 유지하기 위해 필수적임

4. 오늘 완성한 쉘 스크립트 (git_update.sh)
  Bash
  #!/bin/bash

  # 1. 위치 고정
  cd "$(dirname "$0")"

  echo " git pull 업데이트를 시작합니다. [$(date)] "

  # 2. 충돌방지 3단계 콤보 
  # (서버는 작업하는 곳이 아니라 작업물만 있는 곳이므로 달라진 게 있으면 정리함)

  git checkout .   # 누군가 파일 건드렸으면 건드리기 전으로 원상복구
  git clean -fd    # 혹시 새로 생긴 파일/폴더 있으면 강제 삭제

  # 3. GitHub 본진(origin) 메인 브랜치의 최신 코드 가져오기
  git pull origin main

  echo " 업데이트 완료 "


5. 트러블슈팅 (Troubleshooting)
[사건 1: 서버에서 스크립트 실종]
현상: 서버에서 직접 만든 git_update.sh가 실행 후 삭제됨
원인: git clean -fd가 깃허브에 등록 안 된 이 파일을 '잡동사니'로 인식해 삭제함
해결: 모든 코드는 반드시 노트북(Local) 작성 -> GitHub Push -> 서버 Pull 순서를 지켜야 함

[사건 2: Push 권한 및 작업 순서 오류]
현상: 일반 폴더에서 git push 실패
해결: 
 1. 노트북에 깃허브 저장소를 clone 받아 통로 개설
 2. 완성된 파일은 깃 폴더로 복사(cp) 후 Push
 3. 비밀번호 대신 **Personal Access Token(PAT)**을 사용하여 보안 인증 완료

6. 실무 작업 순서 (Workflow)
노트북: ~/02_practice에서 코드 작성 및 테스트
노트북: 완성된 파일을 깃 폴더(~/devops-study)로 복사
GitHub: 깃 폴더에서 push 하여 본진에 업로드
서버: bash git_update.sh 실행하여 최신 코드 반영
